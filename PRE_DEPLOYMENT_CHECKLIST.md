# üöÄ Pre-Deployment Checklist

Complete this checklist before pushing to GitHub and deploying to Render.

## ‚úÖ Security Check

### Credentials & Secrets
- [x] `.env` file is in `.gitignore`
- [x] No API keys or secrets in code
- [x] B2 credentials only in `.env` (not committed)
- [x] Database credentials only in environment variables
- [x] `SECRET_KEY` loaded from environment variable
- [x] `.env.example` has placeholder values only

### Verification Commands
```bash
# Check if .env is ignored
git check-ignore .env
# Should output: .env

# Search for potential secrets in tracked files
git ls-files | xargs grep -l "005ca07c" 2>/dev/null
# Should return nothing

# Check what will be committed
git status
```

## ‚úÖ Configuration Files

### Django Settings
- [x] `DEBUG=False` for production (set in Render)
- [x] `ALLOWED_HOSTS` configured properly
- [x] Database URL parsing with `dj-database-url`
- [x] B2 storage configured with STORAGES dict
- [x] Security headers enabled
- [x] HTTPS redirects configured for production

### Dependencies
- [x] `requirements.txt` up to date
- [x] All production dependencies included:
  - Django 6.0.2
  - djangorestframework 3.16.1
  - gunicorn 23.0.0
  - whitenoise 6.8.2
  - django-storages 1.14.4
  - boto3 1.35.80
  - mysqlclient 2.2.7

### Render Configuration
- [x] `render.yaml` configured
- [x] `build.sh` script created and executable
- [x] Environment variables documented

## ‚úÖ Code Quality

### Python Code
- [ ] No print() statements for debugging (use logging)
- [ ] No commented-out code blocks
- [ ] No TODO/FIXME without issues
- [ ] All imports used
- [ ] No syntax errors

### Verification Commands
```bash
# Check for syntax errors
python -m py_compile **/*.py

# Find debug prints (manual review needed)
grep -r "print(" --include="*.py" . | grep -v ".venv" | grep -v "migrations"
```

## ‚úÖ Database

- [x] All migrations created
- [x] Migrations are compatible with MySQL
- [x] No hardcoded database connections
- [x] Database credentials in environment variables

### Verification
```bash
# Check for pending migrations (with DB configured)
python manage.py makemigrations --dry-run --check

# List all migrations
python manage.py showmigrations
```

## ‚úÖ Static & Media Files

- [x] `STATIC_ROOT` configured
- [x] `STATIC_URL` set
- [x] WhiteNoise configured for static files
- [x] B2 configured for media uploads
- [x] `collectstatic` in build script

## ‚úÖ Testing

- [x] pytest configured
- [x] Test files present
- [x] Tests can run without database (or with test DB)

### Optional: Run Tests
```bash
# Run all tests
pytest

# Run with coverage
pytest --cov=.
```

## ‚úÖ Documentation

- [x] README.md up to date
- [x] API documentation available
- [x] Deployment guide created
- [x] Environment variables documented
- [x] B2 setup documented

## ‚úÖ Git Repository

### Before First Push
```bash
# Initialize git (if not already)
git init

# Add all files
git add .

# Check what will be committed
git status

# Verify .env is NOT in staging
git ls-files | grep ".env$"
# Should return nothing

# Commit
git commit -m "Initial commit: Project Management API with B2 storage"

# Add remote
git remote add origin git@github.com:your-username/Project-Management-API.git

# Push
git push -u origin main
```

### Files That Should NOT Be Committed
- `.env` (contains secrets)
- `.venv/` (virtual environment)
- `__pycache__/` (Python cache)
- `*.pyc` (compiled Python)
- `db.sqlite3` (local database)
- `media/` (local media files)
- `staticfiles/` (collected static files)
- `logs/*.log` (log files)

## ‚úÖ Render Deployment

### Environment Variables to Set in Render

**Required:**
```
SECRET_KEY=<auto-generated>
DEBUG=False
ALLOWED_HOSTS=your-app.onrender.com
DATABASE_URL=<from-render-database>
USE_B2_STORAGE=True
B2_APPLICATION_KEY_ID=005ca07c1f233510000000001
B2_APPLICATION_KEY=K005PpU0x0VwVClkVYBpYuiNcmn70j0
B2_BUCKET_NAME=Project-Management-API
B2_ENDPOINT_URL=https://s3.us-east-005.backblazeb2.com
B2_REGION=us-east-005
```

**Security (Recommended):**
```
SECURE_SSL_REDIRECT=True
SESSION_COOKIE_SECURE=True
CSRF_COOKIE_SECURE=True
SECURE_HSTS_SECONDS=31536000
SECURE_HSTS_INCLUDE_SUBDOMAINS=True
SECURE_HSTS_PRELOAD=True
```

### Deployment Steps

1. **Create Render Account**: https://render.com
2. **New Blueprint**: Connect GitHub repo
3. **Render will detect** `render.yaml`
4. **Set environment variables** in dashboard
5. **Deploy**: Automatic on git push

### Post-Deployment

- [ ] Check build logs for errors
- [ ] Verify web service is running
- [ ] Test API endpoint: `https://your-app.onrender.com/api/`
- [ ] Test user registration
- [ ] Test avatar upload (should go to B2)
- [ ] Check B2 bucket for uploaded files
- [ ] Monitor logs for issues

## üîß Final Verification Commands

```bash
# 1. Ensure virtual environment is active
source .venv/bin/activate

# 2. Check for secrets in tracked files
git ls-files | xargs grep -E "005ca07c|K005PpU0x0VwVClkVYBpYuiNcmn70j0" 2>/dev/null
# Should return nothing

# 3. Verify .env is ignored
git check-ignore .env
# Should output: .env

# 4. Check what will be pushed
git status

# 5. View changes (optional)
git diff

# 6. Test B2 connection
python -c "
import django, os
os.environ.setdefault('DJANGO_SETTINGS_MODULE', 'pmtool.settings')
django.setup()
from django.core.files.storage import storages
print('Storage:', type(storages['default']).__name__)
"

# 7. Verify build script is executable
ls -la build.sh | grep "x"
# Should show execute permissions
```

## üìä Pre-Push Summary

Run these commands right before pushing:

```bash
echo "=== Security Check ==="
git ls-files | xargs grep -l "005ca07c\|K005PpU0x0VwVClkVYBpYuiNcmn70j0" 2>/dev/null || echo "‚úÖ No credentials found"

echo -e "\n=== .env Status ==="
git check-ignore .env && echo "‚úÖ .env is ignored" || echo "‚ùå WARNING: .env may be tracked!"

echo -e "\n=== Files to be committed ==="
git status --short

echo -e "\n=== Branch Status ==="
git branch -vv

echo -e "\n‚úÖ All checks passed! Ready to push."
```

## üéâ You're Ready!

Once all boxes are checked:

```bash
git add .
git commit -m "Add B2 storage and Render deployment config"
git push origin main
```

Then deploy on Render and your API will be live! üöÄ
